//Polluting the global namespace in order to make calls look cleaner.  I have no shame.

var users = require('./mock/users.json');
var fs = require('fs');
var clicksend = require('clicksend');


//Get authentication from file.
var dedicatedNum;
fs.readFile('./node_modules/shiftswap/apikey.txt', function(err, data){
	if(err){
		if(err.errno === -4058)
			return console.error(
				'Error: Create apikey.txt in node_modules/shiftswap.\n'+
				'Line 1: your api key.\n'+
				'Line 2: your username.\n'+
				'Line 3: your dedicated number (optional).'
			);
		return console.error(err);
	}

	var config = clicksend.configuration;
	var out = data.toString().split('\r\n');
	config.apikey   = out[0];
	config.username = out[1];
	dedicatedNum    = out[2];
});





home = {
	welcome: function(req, res){

		res.send(['Welcome to the APIs!']);
	}
};
user = {
	all: function(req, res){
		res.send(users);
	},
	userid: function(req, res){

		var userid = JSON.parse(req.params.userid);
		if(!users.some(function(obj){
				if(obj.userid === userid){
					res.send('<p>'+JSON.stringify(obj)+'</p>');
					return true;
				}
		})){
			res.send('<p>No userid matches '+userid+'</p>');
		}
	},
	role: function(req, res){

	},
	name: function(req, res){

	},
};
stats = {
	all: function(req, res){

	},
};
schedule = {
	userid: function(req, res){

	},
	role: function(req, res){
		var day = JSON.parse(req.params.day);
		fs.readFile('./node_modules/shiftswap/mock/employee/'+day+'.json', function(err, data){
			if(err)
				return console.error(err);
			res.send(data.toString());
		});

	},
};
logged = {
	never: function(req, res){

	},
	last: function(req, res){

	},
};
trade = {
	shop: function(req, res){

	},
	pend: function(req, res){

	},
	fail: function(req, res){

	},
};
history = {
	self: function(req, res){

	},
	userid: function(req, res){

	},
};

sms = {
	send: function(req, res){
		var number  = JSON.parse(req.params.number);
		var msg     = 'hello world';
		clicksend.SMSController.sendSms({
			"messages":[{
				"from": dedicatedNum,
				"body": msg,
				"to":   "+1"+number,
				"custom_string": "uid: 1001, sid: 10, role: [floor,admin]",
			}]
		}, function(error, smsRes){
			if(error)
				return console.log(error);
			
			res.send(smsRes);
		});
	},
	poll: function(req, res){
		var commands = [
			'today','now',
			'yesterday','prev',
			'tomorrow','next',
			'monday','tuesday','wednesday','thursday','friday','saturday','sunday',
			'date',
			
			'alarm','warm','remind',

			'break',
			'end','out',

			'prefix user'
		];

		clicksend.SMSController.getInboundSms(function(error, smsRes){
			if(error)
				return console.log(error);

			console.log(req);
			console.log(res);
			console.log(smsRes);
		});
	},
}


voice = {
	send: function(req, res){
		var number  = JSON.parse(req.params.number);
		var msg     = 'hello world';
		clicksend.VoiceController.sendVoice({
			"messages":[{
				"from": dedicatedNum,
				"body": msg,
				"to":   "+1"+number,

			}]
		}, function(error, smsRes){
			if(error){
				console.log(error);
				return;
			}		
			res.send(smsRes);
		});
	},
}